<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <title>Store Transfer</title>
  <style>
    body { font-family: Arial, sans-serif; background: #fff; margin: 20px; }
    h2 { text-align: center; }
    select, input, button { padding: 8px; margin: 5px; }
    #products, #cart { border: 1px solid #ccc; padding: 10px; min-height: 200px; margin-top: 10px; }
    .item { display: flex; justify-content: space-between; margin: 5px 0; }
    .item button { margin-left: 10px; }
    #cart .item input { width: 50px; margin-left: 5px; }
  </style>
</head>
<body>

  <h2>From Branch ‚ûù To Branch</h2>

  <div>
    <label>From Branch:</label>
    <select id="fromBranch">
      <option value="">Select branch</option>
      <option value="Riyadh">Riyadh</option>
      <option value="Jeddah">Jeddah</option>
      <option value="Dammam">Dammam</option>
      <option value="Mecca">Mecca</option>
    </select>

    <label>To Branch:</label>
    <select id="toBranch">
      <option value="">Select branch</option>
      <option value="Riyadh">Riyadh</option>
      <option value="Jeddah">Jeddah</option>
      <option value="Dammam">Dammam</option>
      <option value="Mecca">Mecca</option>
    </select>
  </div>

  <div>
    <input type="text" id="search" placeholder="Search by name or SKU">
  </div>

  <h3>Products</h3>
  <div id="products"></div>

  <h3>Cart</h3>
  <div id="cart"></div>

  <button onclick="submitOrder()">Submit Order</button>

  <script>
    const PRODUCTS = [
      { sku: "SKU001", name: "Bike 1", quantity: 10 },
      { sku: "SKU002", name: "Bike 2", quantity: 15 },
      { sku: "SKU003", name: "Scooter 1", quantity: 20 },
      { sku: "SKU004", name: "Helmet", quantity: 25 },
      { sku: "SKU005", name: "Lock", quantity: 30 },
      { sku: "SKU006", name: "Light", quantity: 18 },
      { sku: "SKU007", name: "Bell", quantity: 40 },
      { sku: "SKU008", name: "Seat", quantity: 12 },
      { sku: "SKU009", name: "Basket", quantity: 14 },
      { sku: "SKU010", name: "Pump", quantity: 22 },
      { sku: "SKU011", name: "Gloves", quantity: 16 },
      { sku: "SKU012", name: "Mirror", quantity: 9 },
      { sku: "SKU013", name: "Stand", quantity: 11 },
      { sku: "SKU014", name: "Brake Pads", quantity: 20 },
      { sku: "SKU015", name: "Chain", quantity: 8 },
      { sku: "SKU016", name: "Pedals", quantity: 13 },
      { sku: "SKU017", name: "Handlebar", quantity: 17 },
      { sku: "SKU018", name: "Wheel", quantity: 19 },
      { sku: "SKU019", name: "Bottle Holder", quantity: 7 },
      { sku: "SKU020", name: "Charger", quantity: 5 }
    ];

    let CART = {};

    function renderProducts() {
      const search = document.getElementById("search").value.toLowerCase();
      const container = document.getElementById("products");
      container.innerHTML = "";
      PRODUCTS.filter(p => p.name.toLowerCase().includes(search) || p.sku.toLowerCase().includes(search))
        .forEach(p => {
          const div = document.createElement("div");
          div.className = "item";
          div.innerHTML = `${p.sku} - ${p.name} 
            <button onclick="addToCart('${p.sku}')">Add</button>`;
          container.appendChild(div);
        });
    }

    function renderCart() {
      const container = document.getElementById("cart");
      container.innerHTML = "";
      Object.values(CART).forEach(item => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `${item.sku} - ${item.name} 
          <input type="number" value="${item.quantity}" min="1" onchange="updateQty('${item.sku}', this.value)">
          <button onclick="removeFromCart('${item.sku}')">Remove</button>`;
        container.appendChild(div);
      });
    }

    function addToCart(sku) {
      const product = PRODUCTS.find(p => p.sku === sku);
      if (!CART[sku]) {
        CART[sku] = { ...product, quantity: 1 };
      } else {
        CART[sku].quantity++;
      }
      renderCart();
    }

    function removeFromCart(sku) {
      delete CART[sku];
      renderCart();
    }

    function updateQty(sku, qty) {
      CART[sku].quantity = parseInt(qty);
    }

    function buildCSV() {
      let csv = "SKU,Quantity\n";
      Object.values(CART).forEach(item => {
        csv += `${item.sku},${item.quantity}\n`;
      });
      return csv;
    }

    async function submitOrder() {
      const fromBranch = document.getElementById("fromBranch").value;
      const toBranch = document.getElementById("toBranch").value;

      if (!fromBranch || !toBranch) {
        alert("Select both branches.");
        return;
      }
      if (!Object.keys(CART).length) {
        alert("Cart is empty.");
        return;
      }

      const csv = buildCSV();
      try {
        const res = await fetch("https://api.zipper.com/upload", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            fileName: `transfer_${Date.now()}.csv`,
            content: csv
          })
        });
        const data = await res.json();
        console.log("Sent to Zipper:", data);
        alert("Order submitted successfully!");
      } catch (err) {
        console.error("Error sending to Zipper:", err);
        alert("Error submitting order.");
      }
    }

    document.getElementById("search").addEventListener("input", renderProducts);
    renderProducts();
  </script>

</body>
</html>
