<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Sales Mobile App v1</title>
  <style>
    :root{ --bg:#ffffff; --text:#0a0a0a; --muted:#6b7280; --line:#e5e7eb; --btn:#111111; --btnText:#ffffff; --ok:#10b981; --warn:#ef4444; --card:#ffffff; --shadow:0 4px 14px rgba(0,0,0,.06);} 
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{max-width:420px;margin:0 auto;padding:16px 14px}
    header{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px 0 14px;border-bottom:1px solid var(--line);position:sticky;top:0;background:#fff;z-index:5}
    h1{font-size:18px;margin:0;font-weight:700}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px 12px;box-shadow:var(--shadow)}
    label{display:block;font-size:13px;color:#111;margin:8px 2px 6px}
    input, select, textarea{width:100%;padding:12px 12px;border:1px solid var(--line);border-radius:12px;font-size:16px;background:#fff;outline:none;appearance:none;-webkit-appearance:none;-moz-appearance:none;text-align:center}
    input:focus, select:focus, textarea:focus{border-color:#111}
    input[type=number]::-webkit-outer-spin-button, input[type=number]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0 }
    input[type=number]{ -moz-appearance:textfield }
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .row{display:grid;gap:10px;margin-top:10px}
    .muted{color:var(--muted);font-size:12px}
    .total-box{display:flex;align-items:center;justify-content:space-between;border:1px dashed var(--line);border-radius:14px;padding:12px 14px;background:#fafafa}
    .footer{margin:8px 0 40px;color:var(--muted);font-size:12px;text-align:center}
    .sendbar{position:sticky;bottom:0;left:0;right:0;background:#fff;padding:6px 0;margin-top:6px}
    .sendbar .btn{width:100%;border-radius:12px;border:1px solid #111;background:#111;color:#fff;height:48px;font-size:16px}

    /* Center overlay for loading/success/error */
    .overlay{position:fixed;inset:0;background:rgba(255,255,255,.85);display:none;align-items:center;justify-content:center;z-index:100}
    .overlay .box{display:flex;flex-direction:column;align-items:center;gap:12px;background:#fff;border:1px solid var(--line);border-radius:16px;padding:18px 20px;box-shadow:var(--shadow);min-width:240px}
    .spinner{width:28px;height:28px;border:3px solid #ddd;border-top-color:#111;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Review/Confirm states */
    .confirm-pending{ border:2px solid #b45309 !important; box-shadow:0 0 0 2px rgba(180,83,9,.08) inset }
    .confirm-ok{ border:2px solid #047857 !important; box-shadow:0 0 0 2px rgba(4,120,87,.08) inset }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>تطبيق الإقفالات اليومي</h1>
      <small class="muted">تطبيق داخلي خاص</small>
    </header>

    <div class="card">
      <!-- باقي الخانات نفسها -->
      <div class="grid-3">
        <div><label for="cash">Cash</label><input id="cash" type="number" /></div>
        <div><label for="mada">Mada</label><input id="mada" type="number" /></div>
        <div><label for="visa">Visa/Master</label><input id="visa" type="number" /></div>
        <div><label for="tabby">Tabby</label><input id="tabby" type="number" /></div>
        <div><label for="tamara">Tamara</label><input id="tamara" type="number" /></div>
        <div><label for="rajhi">Rajhi Transfer</label><input id="rajhi" type="number" /></div>
        <div><label for="tap">Tap</label><input id="tap" type="number" /></div>
        <div><label for="madfu">Madfu</label><input id="madfu" type="number" /></div>
        <div><label for="inmaa">Inmaa Transfer</label><input id="inmaa" type="number" /></div>
      </div>

      <div class="row">
        <div class="total-box">
          <div class="muted">Total</div>
          <input id="total" type="number" />
        </div>
      </div>
    </div>

    <div class="sendbar">
      <div class="wrap" style="padding:0 14px;">
        <button id="btnSend" class="btn">تأكيد الإدخالات</button>
      </div>
    </div>
  </div>

  <div id="overlay" class="overlay">
    <div class="box">
      <div class="spinner" id="ovSpin"></div>
      <div id="ovText" class="muted" style="font-size:14px; text-align:center"></div>
    </div>
  </div>

  <script>
    const $ = (sel)=>document.querySelector(sel);
    const amountIds = ['cash','mada','visa','tabby','tamara','rajhi','tap','madfu','inmaa','total'];

    function showOverlay(text, spin=true){
      $('#ovText').textContent = text;
      $('#ovSpin').style.display = spin?'block':'none';
      $('#overlay').style.display = 'flex';
    }
    function hideOverlay(){ $('#overlay').style.display = 'none'; }

    function inReview(){ return $('#btnSend').dataset.mode !== 'send'; }

    function enterReviewMode(){
      amountIds.forEach(id=>{
        const el=document.getElementById(id);
        el.dataset.reviewValue=el.value||'';
        el.dataset.confirmed='0';
        el.classList.add('confirm-pending');
        el.addEventListener('input', ()=>{
          el.dataset.confirmed='0';
          el.classList.add('confirm-pending');
          el.classList.remove('confirm-ok');
          updateButtonState();
        });
        el.addEventListener('click', ()=>{
          if(inReview()){
            if(el.value===(el.dataset.reviewValue||'')){
              el.dataset.confirmed='1';
              el.classList.add('confirm-ok');
              el.classList.remove('confirm-pending');
              updateButtonState();
            }
          }
        });
      });
      showOverlay('اضغط على كل خانة بعد المراجعة حتى تتحول للإطار الأخضر', false);
      setTimeout(hideOverlay,2000);
    }

    function allConfirmed(){ return amountIds.every(id=>$('#'+id).dataset.confirmed==='1'); }

    function updateButtonState(){
      const btn=$('#btnSend');
      if(allConfirmed()){
        btn.dataset.mode='send';
        btn.textContent='إرسال الإقفال اليومي';
      } else {
        btn.dataset.mode='review';
        btn.textContent='تأكيد الإدخالات';
      }
    }

    document.getElementById('btnSend').addEventListener('click', ()=>{
      const btn=$('#btnSend');
      if(inReview()){
        if(!$('#cash').classList.contains('confirm-pending')) enterReviewMode();
        if(!allConfirmed()){
          showOverlay('أكمل تأكيد جميع الخانات', false);
          setTimeout(hideOverlay,2000);
          return;
        }
      }
      // هنا يكون جاهز للإرسال الطبيعي إلى Zapier
      showOverlay('تم إرسال التقفيلة بنجاح ✅', false);
      setTimeout(hideOverlay,2000);
    });
  </script>
</body>
</html>
